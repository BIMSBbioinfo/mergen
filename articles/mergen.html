<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mergen">
<title>Introduction to mergen • mergen</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to mergen">
<meta property="og:description" content="mergen">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mergen</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/mergen.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/BIMSBbioinfo/mergen" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to mergen</h1>
            
      
      
      <div class="d-none name"><code>mergen.Rmd</code></div>
    </div>

    
    
<p>mergen is a package which employs artificial intelligence to convert
data analysis questions into executable code, explanations, and
algorithms. The self-correction features allow the generated code to be
optimized for performance and accuracy. mergen features a user-friendly
chat interface, enabling users to interact with the AI agent and extract
valuable insights from their data effortlessly.</p>
<p>This document introduces you to mergens basic set of tools, and shows
you how to apply them to answer data analysis related questions and
generate relevant R code.</p>
<div class="section level3">
<h3 id="setting-up-an-ai-agent">Setting up an AI-agent<a class="anchor" aria-label="anchor" href="#setting-up-an-ai-agent"></a>
</h3>
<p>To be able to interact with an AI agent and use this agent for
subsequent tasks, mergen contains the <code>setupAgent</code> function
for setting up a framework for the agent.Mergen allows you to set up an
agent for the openai API platform as well as for the replicate API
platform.</p>
<div class="section level4">
<h4 id="setting-up-an-openai-agent">Setting up an openai agent<a class="anchor" aria-label="anchor" href="#setting-up-an-openai-agent"></a>
</h4>
<p>For setting up an agent for the openai API platform, you can make use
of the <code>setupAgent</code> function by setting the
<code>name="openai"</code> argument. Let’s look how to setting up an
agent works:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myAgent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setupAgent.html">setupAgent</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"openai"</span>,type<span class="op">=</span><span class="st">"chat"</span>,model<span class="op">=</span><span class="st">"gpt-4"</span>,ai_api_key <span class="op">=</span> <span class="st">"your_key"</span><span class="op">)</span></span>
<span><span class="va">myAgent</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "userAgent"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $type</span></span>
<span><span class="co">#&gt; [1] "chat"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $API</span></span>
<span><span class="co">#&gt; [1] "openai"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $url</span></span>
<span><span class="co">#&gt; [1] "https://api.openai.com/v1/chat/completions"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $model</span></span>
<span><span class="co">#&gt; [1] "gpt-4"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers</span></span>
<span><span class="co">#&gt;      Authorization       Content-Type </span></span>
<span><span class="co">#&gt;  "Bearer your_key" "application/json" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ai_api_key</span></span>
<span><span class="co">#&gt; [1] "your_key"</span></span></code></pre></div>
<p>the <code>setupAgent</code> function returns a list containing all
the agent information which can be used by subsequent functions.
mportant to note is that the <code>ai_api_key</code> should be your
OpenAI API key, provided as a string.</p>
</div>
<div class="section level4">
<h4 id="setting-up-an-agent-for-replicate">Setting up an agent for replicate<a class="anchor" aria-label="anchor" href="#setting-up-an-agent-for-replicate"></a>
</h4>
<p><code>setupAgent</code> also contains functionality for setting up an
agent for replicate AIs. Let’s look at how this works:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myAgent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setupAgent.html">setupAgent</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"replicate"</span>,type<span class="op">=</span><span class="cn">NULL</span>,model<span class="op">=</span><span class="st">"llama-2-70b-chat"</span>,ai_api_key<span class="op">=</span><span class="st">"my_key"</span><span class="op">)</span></span>
<span><span class="va">myAgent</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "userAgent"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $type</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $API</span></span>
<span><span class="co">#&gt; [1] "replicate"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $url</span></span>
<span><span class="co">#&gt; [1] "https://api.replicate.com/v1/predictions"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $model</span></span>
<span><span class="co">#&gt; [1] "llama-2-70b-chat"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers</span></span>
<span><span class="co">#&gt;      Authorization       Content-Type </span></span>
<span><span class="co">#&gt;     "Token my_key" "application/json" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ai_api_key</span></span>
<span><span class="co">#&gt; [1] "my_key"</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="sending-a-prompt">Sending a prompt<a class="anchor" aria-label="anchor" href="#sending-a-prompt"></a>
</h3>
<p>Once you have set up an agent, it is time to ask some questions to
your AI model of choice! For this, you can make use of the
<code>sendPrompt</code> function, or the <code>selfcorrect</code>
function. The choice of which one to use depends on whether you want
possible errors in the answered code to be corrected by sending another
request to the model or not.</p>
<div class="section level4">
<h4 id="using-the-sendprompt-function">Using the sendPrompt function<a class="anchor" aria-label="anchor" href="#using-the-sendprompt-function"></a>
</h4>
<p>Sending a prompt with the <code>sendPrompt</code> function is very
easy. The function takes the arguments <code>agent</code>,
<code>prompt</code>, <code>return.type</code> and <code>context</code>.
By default the context is set to rbionfoExp. This tells your model of
choice to act as a bioinformatics expert, and return any code as R code
in triple backticks. Your prompt must be given as a string, but can
contain any question and additional information that you want to send.
The return value is a string containing the models answer.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">answer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sendPrompt.html">sendPrompt</a></span><span class="op">(</span><span class="va">myAgent</span>,</span>
<span>                     <span class="st">"how do I perform PCA on data in</span></span>
<span><span class="st">                     a file called test.txt?"</span>,return.type <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span></span>
<span><span class="va">answer</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "\n\nThe following R code will read the file called \"test.txt\", normalize the table and do PCA. First, the code will read the file into an R data frame: \n\n```\ndata &lt;- read.table(\"test.txt\", header = TRUE, sep = \"\\t\")\n```\n\nNext, the data will be normalized to the range of 0 to 1:\n\n```\nnormalized.data &lt;- scale(data, center = TRUE, scale = TRUE)\n```\n\nFinally, the normalized data will be used to do a Principal Component Analysis (PCA):\n\n```\npca &lt;- princomp(normalized.data)\n```"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="using-the-selfcorrect-function">Using the selfcorrect function<a class="anchor" aria-label="anchor" href="#using-the-selfcorrect-function"></a>
</h4>
<p>Sending a prompt with the selfcorrect function, will allow the
possible generated code to be optimized for performance and accuracy. If
the code that is returned by the model is not excecutable, the
selfcorrect function will send the prompt back to the agent together
with a list of errors and warnings, so that the code can be optimized.
The amount of rounds of possible selfcorrect can be set by the user
using the <code>attempts = n</code> argument. The return value is a list
containing the initial answer of the agent and the final answer after n
rounds of selfcorrection.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">answer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selfcorrect.html">selfcorrect</a></span><span class="op">(</span><span class="va">myAgent</span>, prompt<span class="op">=</span><span class="st">"How do I perform PCA?"</span>,attempts<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">answer</span><span class="op">)</span></span>
<span><span class="co">#&gt; $init.response</span></span>
<span><span class="co">#&gt; [1] "\n\nThe following R code will read the file called \"test.txt\", normalize the table and do PCA. First, the code will read the file into an R data frame: \n\n```R\ndata &lt;- read.table(\"test.txt\", header = TRUE, sep = \"\\t\")\n```\n\nNext, the data will be normalized to the range of 0 to 1:\n\n```{r}\nnormalized.data &lt;- scale(data, center = TRUE, scale = TRUE)\n```\n\nFinally, the normalized data will be used to do a Principal Component Analysis (PCA):\n\n```{R}\npca &lt;- princomp(normalized.data)\n```"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $init.blocks</span></span>
<span><span class="co">#&gt; $init.blocks$code</span></span>
<span><span class="co">#&gt; [1] "\ndata &lt;- read.table(\"test.txt\", header = TRUE, sep = \"\\t\")\n\n\nnormalized.data &lt;- scale(data, center = TRUE, scale = TRUE)\n\n\npca &lt;- princomp(normalized.data)\n"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $init.blocks$text</span></span>
<span><span class="co">#&gt; [1] "\n\nThe following R code will read the file called \"test.txt\", normalize the table and do PCA. First, the code will read the file into an R data frame: \n\n\n\n\nNext, the data will be normalized to the range of 0 to 1:\n\n\n\n\nFinally, the normalized data will be used to do a Principal Component Analysis (PCA):\n\n\n"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $final.response</span></span>
<span><span class="co">#&gt; [1] "\n\nThe third response.The following R code will read the file called \"test.txt\", normalize the table and do PCA. First, the code will read the file into an R data frame: \n\n```{r}\nplot(1:10)```\n\nNext, the data will be normalized to the range of 0 to 1:\n\n"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $final.blocks</span></span>
<span><span class="co">#&gt; $final.blocks$code</span></span>
<span><span class="co">#&gt; [1] "\nplot(1:10)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $final.blocks$text</span></span>
<span><span class="co">#&gt; [1] "\n\nThe third response.The following R code will read the file called \"test.txt\", normalize the table and do PCA. First, the code will read the file into an R data frame: \n\n\n\n\nNext, the data will be normalized to the range of 0 to 1:\n\n"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $code.works</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $exec.result</span></span>
<span><span class="co">#&gt; [1] "path/to/html/file"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tried.attempts</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="running-the-code">Running the code<a class="anchor" aria-label="anchor" href="#running-the-code"></a>
</h3>
<div class="section level4">
<h4 id="extracting-code-blocks">Extracting code blocks<a class="anchor" aria-label="anchor" href="#extracting-code-blocks"></a>
</h4>
<p>Once you have sent a prompt and recieved the answer, mergen features
a function <code>extractCode</code> that allows the user to extract code
blocks from the given text. Before using this, however, the code blocks
need to be cleaned up, as every agent will return its answer in a
slightly different way. This can be done with the help of the
<code>clean_code_blocks</code> function. Below is an example of what
<code>clean_code_blocks</code> does with the answer returned by our
agent above:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">code_cleaned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_code_blocks.html">clean_code_blocks</a></span><span class="op">(</span><span class="va">answer</span><span class="op">$</span><span class="va">final.response</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">code_cleaned</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The third response.The following R code will read the file called "test.txt", normalize the table and do PCA. First, the code will read the file into an R data frame: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; plot(1:10)```</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Next, the data will be normalized to the range of 0 to 1:</span></span></code></pre></div>
<p>As you can see above, <code>clean_code_blocks</code> ensures that all
code is stripped from extra symbols such as {r}, R, r and {R}. This
ensures that the function <code>extractCode</code> can extract the code
blocks properly. The <code>extractCode</code> function takes as input a
string, and also allows the user to set a delimiter used to enclose the
code blocks (default is three backtics). Now lets have a look at what
the <code>extractCode</code> function returns:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractCode.html">extractCode</a></span><span class="op">(</span><span class="va">code_cleaned</span>,delimiter <span class="op">=</span> <span class="st">"```"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span> <span class="op">(</span><span class="va">final_code</span><span class="op">)</span></span>
<span><span class="co">#&gt; $code</span></span>
<span><span class="co">#&gt; [1] "\nplot(1:10)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $text</span></span>
<span><span class="co">#&gt; [1] "\n\nThe third response.The following R code will read the file called \"test.txt\", normalize the table and do PCA. First, the code will read the file into an R data frame: \n\n\n\n\nNext, the data will be normalized to the range of 0 to 1:\n\n"</span></span></code></pre></div>
<p>As shown above, <code>extractCode</code> returns a list containing
the actual code and the associated text. The code block can then be
tested for execution using the <code>executeCode</code> function.</p>
</div>
<div class="section level4">
<h4 id="running-the-code-1">Running the code<a class="anchor" aria-label="anchor" href="#running-the-code-1"></a>
</h4>
<p>mergen features functions that make it easy for the user to run the
code returned by an AI agent. Once code blocks are cleaned up and
extracted, code blocks can be executed using the
<code>executeCode</code> function. Before doing that, however, it is
advised to run the <code>extractInstallPkg</code> function. This
function extracts package names and installs any missing packages needed
for the code to run. Finally, the <code>executeCode</code> function can
be used. Lets see what the <code>executeCode</code> function does:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/executeCode.html">executeCode</a></span><span class="op">(</span><span class="va">final_code</span><span class="op">$</span><span class="va">code</span><span class="op">)</span></span></code></pre></div>
<p><img src="mergen_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span></code></pre>
<p>As shown above, the code runs as it should! It is important to note
that the <code>executeCode</code> function will not change the global
environment. Any variables that might be created while executing the
code will be deleted as the function completes.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Altuna Akalin, Jacqueline Anne Jansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
